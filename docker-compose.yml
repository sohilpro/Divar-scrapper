version: "3.8"

x-bot-config: &bot-config
  build: .
  restart: always
  shm_size: "2gb"
  env_file: .env
  deploy:
    resources:
      limits:
        memory: 600M
      reservations:
        memory: 200M

services:
  # ===================== REDIS SERVICE =====================
  redis:
    image: redis:alpine
    container_name: divar-redis
    restart: always
    # Ø§ÛŒÙ† Ú©Ø§Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¯ÛŒØªØ§ Ø±ÙˆÛŒ Ø¯ÛŒØ³Ú© Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª ØªØ§ Ø¨Ø§ Ø±ÛŒØ³ØªØ§Ø±Øª Ø¯ÛŒØªØ§ÛŒ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ù¾Ø±Ø¯
    command: redis-server --appendonly yes
    volumes:
      - ./redis-data:/data
    ports:
      - "6380:6379" # Ø¨ÛŒØ±ÙˆÙ†: 6380 | Ø¯Ø§Ø®Ù„: 6379

  # ===================== DIVAR BOTS =====================

  # 1. MAZANDARAN
  divar-mazandaran:
    <<: *bot-config
    container_name: div-mazandaran
    command: node Divar-MZNDRN/src/index.js
    environment:
      - PORT=3001
      - BOT_TOKEN=${TOKEN_MAZANDARAN}
      - REDIS_HOST=redis
      - REDIS_PORT=6379 # ðŸ‘ˆðŸ‘ˆ Ù…Ù‡Ù…: Ø¯Ø§Ø®Ù„ Ø¯Ø§Ú©Ø± Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ù¾ÙˆØ±Øª Ø§ØµÙ„ÛŒ ÙˆØµÙ„ Ø´ÙˆØ¯

  # 2. QOM - ARAK
  divar-qom-arak:
    <<: *bot-config
    container_name: div-qom-arak
    command: node Divar-QOM-ARAK/src/index.js
    environment:
      - PORT=3002
      - BOT_TOKEN=${TOKEN_QOM_ARAK}
      - REDIS_HOST=redis
      - REDIS_PORT=6379 # ðŸ‘ˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯

  # 3. SHIRAZ - ISFAHAN
  divar-shiraz-isfahan:
    <<: *bot-config
    container_name: div-shiraz-isfahan
    command: node Divar-SHZ-ISFHN/src/index.js
    environment:
      - PORT=3003
      - BOT_TOKEN=${TOKEN_SHIRAZ_ISFAHAN}
      - REDIS_HOST=redis
      - REDIS_PORT=6379 # ðŸ‘ˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯

  # 4. TEHRAN - SEMNAN
  divar-tehran-semnan:
    <<: *bot-config
    container_name: div-tehran-semnan
    command: node Divar-THR-SMNAN/src/index.js
    environment:
      - PORT=3004
      - BOT_TOKEN=${TOKEN_TEHRAN_SEMNAN}
      - REDIS_HOST=redis
      - REDIS_PORT=6379 # ðŸ‘ˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯

  # 5. YAZD - GILAN
  divar-yazd-gilan:
    <<: *bot-config
    container_name: div-yazd-gilan
    command: node Divar-YAZD-GILAN/src/index.js
    environment:
      - PORT=3005
      - BOT_TOKEN=${TOKEN_YAZD_GILAN}
      - REDIS_HOST=redis
      - REDIS_PORT=6379 # ðŸ‘ˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯
